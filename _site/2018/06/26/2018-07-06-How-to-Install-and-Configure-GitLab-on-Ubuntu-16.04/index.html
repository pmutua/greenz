<p>GitLab is available in four editions:</p>

<ul>
  <li>Gitlab CE (Community Edition) - self-hosted, free and support from the Community forum.</li>
  <li>Gitlab EE (Enterprise Edition) - self-hosted, paid app, comes with additional features.</li>
  <li>GitLab.com - SaaS, free.</li>
  <li>GitLab.io - Private GitLab instance managed by GitLab Inc.</li>
</ul>

<p>In this tutorial, I will show you step-by-step how to install GitLab CE (Community Edition) on your own Ubuntu 16.04 Xenial Xerus server. In this tutorial, I will be using the ‘omnibus’ package provided by GitLab for easy installation.</p>

<h1 id="what-we-will-do">What we will do:</h1>
<ul>
  <li>Install Packages</li>
  <li>Install GitLab</li>
  <li>Configure GitLab URL</li>
  <li>Generate SSL Let’s encrypt and DHPARAM Certificate</li>
  <li>Enable Nginx HTTPS for GitLab</li>
  <li>Configure UFW Firewall</li>
  <li>Perform the GitLab Installation</li>
  <li>Testing</li>
</ul>

<h1 id="prerequisites">Prerequisites</h1>

<ul>
  <li>Ubuntu 16.04 Server - 64bit</li>
  <li>Min RAM 2GB</li>
  <li>Root Privileges</li>
</ul>

<h1 id="step-1---install-required-ubuntu-packages">Step 1 - Install required Ubuntu Packages</h1>

<p>The first step is to install the packages needed for the GitLab installation. Please log in to the server as root user and upddate the Ubuntu repository.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh root@GitLabServer
apt-get update
</code></pre></div></div>

<p>Now install the packages including curl for downloading the GitLab repository, ca-certificates, and postfix for the SMTP configuration.</p>

<p>Install all packages with the apt command below.</p>

<p><code class="highlighter-rouge">sudo apt install curl openssh-server ca-certificates postfix</code></p>

<p>During postfix installation, you will be prompted about the configuration, select ‘Internet Site’.</p>

<p><img src="../assets/blog-img/gitlab-1.png" alt="alt text" title="Logo Title Text 1" /></p>

<p>and then enter the server domain name that shall be used for sending an email.</p>

<p><img src="../assets/blog-img/gitlab-2.png" alt="alt text" title="Logo Title Text 1" /></p>

<h1 id="step-2---install-gitlab">Step 2 - Install Gitlab</h1>

<p>In this step, we will install GitLab using the omnibus packages. Omnibus will install all packages, services, and tools required for running GitLab on your server.</p>

<p>Add GitLab repository with the curl command.</p>

<p><code class="highlighter-rouge">curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash</code></p>

<p><img src="../assets/blog-img/gitlab-term.png" alt="alt text" title="Logo Title Text 1" /></p>

<p>And then install GitLab CE Community Edition with the apt command.</p>

<p><code class="highlighter-rouge">sudo apt install gitlab-ce</code></p>

<p>Wait for the server to download and install the gitlab package. When the installation is complete, you will see the results as below.</p>

<p><img src="../assets/blog-img/gitlab-nano.png" alt="alt text" title="Logo Title Text 1" /></p>

<h1 id="step-3---configure-gitlab-main-url">Step 3 - Configure Gitlab Main URL</h1>

<p>Now we should configure the URL that will be used to access our GitLab server. I will use the domain name ‘gitlab.hakase-labs.co’ for the GitLab URL here (please choose your own domain name) and I’ll use HTTPS for users access security.</p>

<p>The main configuration of GitLab is in the ‘/etc/gitlab’ directory. Go to that directory and edit the configuration file ‘gitlab.rb’ with vim.</p>

<p><code class="highlighter-rouge">cd /etc/gitlab</code></p>

<p><code class="highlighter-rouge">vim gitlab.rb</code></p>

<p>In the GitLab configuration go to line 9 ‘external_url’ and change the URL to your URL ‘gitlab.hakase-labs.co’.</p>

<p><code class="highlighter-rouge">external_url 'http://gitlab.hakase-labs.co'</code></p>

<p>Save the file and exit the editor. In the next step will enable HTTPS for GitLab.</p>

<p><img src="../assets/blog-img/gitlab-r.png" alt="alt text" title="Logo Title Text 1" /></p>

<h1 id="step-4---generate-ssl-lets-encrypt-and-dhparam-certificate">Step 4 - Generate SSL Let’s encrypt and DHPARAM Certificate</h1>

<p>In this step, we will enable the HTTPS protocol for GitLab. I will use a free SSL certificates provided by let’s encrypt for the gitlab domain name.</p>

<p>Install letsencrypt command-line tool with apt command.</p>

<p><code class="highlighter-rouge">sudo apt install letsencrypt -y</code></p>

<p>When the installation is complete, generate a new certificate for the gitlab domain name with the command below.</p>

<p><code class="highlighter-rouge">letsencrypt certonly -d gitlab.hakase-labs.co</code></p>

<p>Enter your email address for the SSL certificate renew notification.</p>

<p><img src="../assets/blog-img/gitlab-image.png" alt="alt text" title="Logo Title Text 1" /></p>

<p>Choose ‘Agree’ for the Let’s Encrypt Terms of Services and wait.</p>

<p><img src="../assets/blog-img/gitlab-image-2.png" alt="alt text" title="Logo Title Text 1" /></p>

<p>When it’s done, you will see the result below.</p>

<p><img src="../assets/blog-img/gitlab-0.png" alt="alt text" title="Logo Title Text 1" /></p>

<p>New Let’s encrypt certificate files for GitLab have been generated. You can find the certificate files in the ‘/etc/letsencrypt/live’ directory.</p>

<p>Next, create a new directory named ‘ssl’ under the GitLab configuration directory.</p>

<p><code class="highlighter-rouge">mkdir -p /etc/gitlab/ssl/</code></p>

<p>And generate dhparam pem files in the ssl directory with the openssl command.</p>

<p><code class="highlighter-rouge">sudo openssl dhparam -out /etc/gitlab/ssl/dhparams.pem 2048</code></p>

<p><img src="../assets/blog-img/gitlab-8.png" alt="alt text" title="Logo Title Text 1" /></p>

<p>Now change the permissions of the certificate files to 600.</p>

<p><code class="highlighter-rouge">chmod 600 /etc/gitlab/ssl/*</code></p>

<p>The SSL Let’s encrypt cert for GitLab and the DHPARAM certificate has been generated.</p>

<h1 id="step-5---enable-nginx-https-for-gitlab">Step 5 - Enable Nginx HTTPS for GitLab</h1>

<p>At this stage, we have the certificate files from Letsencrypt in ‘/etc/letsencrypt/live’ directory and the DHPARAM certificate in the ‘/etc/gitlab/ssl’ directory.</p>

<p>In this step, we will configure a GitLab to use our certificate files. Go to the ‘/etc/gitlab’ directory, then edit ‘gitlab.rb’ configuration with vim.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /etc/gitlab/
vim gitlab.rb
</code></pre></div></div>

<p>Change the external url to use ‘https’ instead of ‘http’.</p>

<p><code class="highlighter-rouge">external_url 'https://gitlab.hakase-labs.co'</code></p>

<p>Then add the new SSL configuration for gitlab as below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
nginx[<span class="s1">'redirect_http_to_https'</span><span class="o">]</span> <span class="o">=</span> <span class="nb">true
</span>nginx[<span class="s1">'ssl_certificate'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"/etc/letsencrypt/live/gitlab.hakase-labs.co/fullchain.pem"</span>
nginx[<span class="s1">'ssl_certificate_key'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"/etc/letsencrypt/live/gitlab.hakase-labs.co/privkey.pem"</span>
nginx[<span class="s1">'ssl_dhparam'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"/etc/gitlab/ssl/dhparams.pem"</span>
</code></pre></div></div>

<p><strong>Note:</strong></p>
<blockquote>
We will enable HTTP to HTTPS redirect in gitlab.gitlab-las.png

Save the file and exit vim.
</blockquote>

<p><img src="../assets/blog-img/gitlab-las.png" alt="alt text" title="Logo Title Text 1" /></p>

<p>Now we need to run the command below as root to apply the new gitlab configuration.</p>

<p><code class="highlighter-rouge">sudo gitlab-ctl reconfigure</code></p>

<p>You will see the results as below.
<img src="../assets/blog-img/gitlab-90.png" alt="alt text" title="Logo Title Text 1" /></p>

<p>HTTPS Configuration for GitLab has been completed.</p>

<h1 id="step-6---configure-ufw-firewall">Step 6 - Configure UFW Firewall</h1>

<p>In this step, we will enable the UFW firewall. It’s already installed on the system, we just need to start the service. We will run GitLab behind the UFW firewall, so we must open the HTTP and HTTPS ports.</p>

<p>Enable UFW firewall with the command below.</p>

<p><code class="highlighter-rouge">ufw enable</code></p>

<p>The command will run ufw service and add it to start automatically at the boot time.</p>

<p>Next, open new ports ssh, HTTP, and HTTPS.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	ufw allow ssh
	ufw allow http
	ufw allow https
</code></pre></div></div>

<p><img src="../assets/blog-img/gitlab-21.png" alt="alt text" title="Logo Title Text 1" /></p>

<p>Now check the firewall status and make sure ssh, http, and https ports is on the list.</p>

<p><code class="highlighter-rouge">ufw status</code></p>

<p>HTTP and HTTPS ports are configured.</p>

