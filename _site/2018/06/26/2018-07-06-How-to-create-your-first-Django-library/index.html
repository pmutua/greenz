<h1 id="contents">Contents</h1>

<h3 id="how-to-create-your-first-django-library">How to create your first Django library</h3>
<ul>
  <li>
    <ol>
      <li>Create your application</li>
    </ol>
  </li>
  <li>
    <ol>
      <li>Packaging</li>
    </ol>
  </li>
  <li>
    <ol>
      <li>Way to run tests without projects</li>
    </ol>
  </li>
  <li>
    <ol>
      <li>Use tox
        <h3 id="conclusion">Conclusion</h3>
      </li>
    </ol>
  </li>
</ul>

<p>On the end, the layout of the package will be like this:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>django-myapp
|-- __init__.py
|-- MANIFEST.in
|-- README.rst
|-- LICENSE
|-- setup.py
|-- test_settings.py
|-- myapp
|   |-- __init__.py
|   |-- models.py
|   |-- views.py
|   <span class="sb">`-- tests.py
`</span>-- tox.ini
</code></pre></div></div>

<p>Whole example project described on this page is on Github: <a href="https://github.com/hirokiky/django-myapp">django-myapp</a>.</p>

<p>This guide includes about packaging or python environments. If you have created couple of python libraries, you can skip over some steps to <a href="http://hirokiky.org/tech/create_django_library.html#way-to-run-django-app-tests">3. Way to run tests without projects</a>. But at least, I expect you to finish the tutorial of <a href="https://docs.djangoproject.com/">django’s document</a> and create some apps.</p>

<h1 id="1-create-your-application">1. Create your application</h1>

<p>When you create third-party library, you won’t need to create a project. Just create your application by using startapp sub-command. But wait. you will distribute this application, so you need a parent directory to package it like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>django-myapp
<span class="nb">cd </span>django-myapp
django-admin.py startapp myapp
</code></pre></div></div>

<p>OK, just it. Write your codes as same as way you learned at tutorial. “Can’t run tests”…? Yeah, I know it. and I’ll show you about it later.</p>

<p>And you need to write README and LICENSE file to describe about your package. I won’t use packages without README or documentation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>README.rst
<span class="nb">touch </span>LICENSE
</code></pre></div></div>

<p>Also It’s good idea to manage packages by using some VCS like git:</p>

<p><code class="highlighter-rouge">git init</code></p>

<h1 id="2-packaging">2. Packaging</h1>

<p>To distribute your app/lib, make it as a package. Just thing you need to do is putting setup.py file under the django-myapp directory meaning next to myapp directory.</p>

<p>The contents of this file will contain information about your package, name, version, description, required packages, and so on:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
<span class="n">README</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">'README.rst'</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">'django-myapp'</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s">'0.1'</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s">'myapp'</span><span class="p">],</span>
    <span class="n">description</span><span class="o">=</span><span class="s">'A line of description'</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">README</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s">'yourname'</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s">'yourname@example.com'</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s">'https://github.com/yourname/django-myapp/'</span><span class="p">,</span>
    <span class="n">license</span><span class="o">=</span><span class="s">'MIT'</span><span class="p">,</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
        <span class="s">'Django&gt;=1.6,&lt;1.7'</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>

</code></pre></div></div>

<p>I recommend you to write them at least.</p>

<p><strong>name</strong>
	The name of package like django-cms. This name will use when you specify the package by pip. So if you name it as django-myapp, users will type pip install django-myapp.
<strong>version</strong>
	Version of you package. I recommend to follow semantic versioning
<strong>packages</strong>
	List of python modules you want to contain. Basically, It’s enough to specify the django application you created.
<strong>description</strong>
	A line of description. It will be used, for example, on package list of PyPI.
<strong>long_description</strong>
	Lines of description. Basically it’s good idea to use README file as long_description. This will be used the package page of PyPI like here django-reportmail
<strong>author</strong>
	Your name.
<strong>author_email</strong>
	Your email address
<strong>url</strong>
	A URL for your web site of the package. Basically, it’s enough to put the URL for your repository on Github and so.
<strong>license</strong>
	The name of license you want to use. I always specify ‘MIT’ meaning the MIT license
<strong>install_requires</strong>
	A list of packages that your packages require. It’s django package, so it’s necessary to write ‘Django’ at least.</p>

<p>All right cool ;)</p>

<p>And then, It requires <code class="highlighter-rouge">MANIFEST.in</code> file on the project directory to specify which files you want to distribute:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>include <span class="k">*</span>.txt <span class="k">*</span>.ini <span class="k">*</span>.cfg <span class="k">*</span>.rst
recursive-include myapp <span class="k">*</span>.ico <span class="k">*</span>.png <span class="k">*</span>.css <span class="k">*</span>.gif <span class="k">*</span>.jpg <span class="k">*</span>.txt <span class="k">*</span>.js <span class="k">*</span>.html <span class="k">*</span>.xml
</code></pre></div></div>

<p>Without this file, templates of your application won’t be included the package. For more detail, refer <a href="https://docs.python.org/3.3/distutils/sourcedist.html#specifying-the-files-to-distribute">official doc about specifying the files to distribute</a></p>

<p>It’s over. After created <code class="highlighter-rouge">setup.py</code>, run this command to register this new package for development:</p>

<p><code class="highlighter-rouge">python setup.py develop</code>
For more detail about setup.py, please refer another documents or packages. Python <a href="http://python-packaging-user-guide.readthedocs.org/">Packaging User Guide</a> will help you. And I imitated setup.py of some another packages. Actually I haven’t read documents so much.</p>

<p>If you want to upload your package to PyPI. just register the application and upload:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python setup.py register
python setup.py sdist upload
</code></pre></div></div>

<p>From the second time, it’s enough to run the second line. Also you can refer the doc about uploading on Python Packaging User Guide</p>

<h1 id="3-way-to-run-tests-without-projects">3. Way to run tests without projects</h1>
<p>Basically django always requires ‘projects’ for all of actions. then how can we run tests? actually It’s easy, you can just use <code class="highlighter-rouge">django-admin.py</code> command and specify settings file for testing. First, create the settings for testing on the project root:</p>

<p><code class="highlighter-rouge">touch test_settings.py</code></p>

<p>And the contents of the file will be like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">'myapp'</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'django.db.backends.sqlite3'</span><span class="p">,</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">':memory:'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">"secret_key_for_testing"</span>

</code></pre></div></div>

<p>Ya, it’s easy. Of cause you can put some additional settings to correspond to tests of your application. And this article about <a href="http://www.machinalis.com/blog/optimizing-your-tests-in-django/">optimizing your tests in Django</a> will be helpful.</p>

<p>To run the test by using the setting, type this command at the project root:</p>

<p><code class="highlighter-rouge">django-admin.py test --settings=test_settings</code></p>

<h1 id="4-use-tox">4. Use tox</h1>

<p>If you want the package to support multiple versions of Python or Django, It’s the best idea to use <a href="https://pypi.python.org/pypi/tox">tox</a>.</p>

<p>Ok, let’s consider a case which supporting two versions of Python, Python2.7 and Python3.3. Put a file name tox.ini on the package root:</p>

<p><code class="highlighter-rouge">touch tox.ini</code></p>

<p>And then, write setting like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>tox]
envlist <span class="o">=</span> py27, py33, flake8

<span class="o">[</span>testenv]
commands <span class="o">=</span>
    pip <span class="nb">install</span> <span class="nt">-e</span> <span class="nb">.</span>
    django-admin.py <span class="nb">test</span> <span class="nt">--settings</span><span class="o">=</span>test_settings
</code></pre></div></div>

<p>To run those tests, install tox and type like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>tox
tox
</code></pre></div></div>

<p>Three bunches of tests will run. tests with Python2.7, Python3.3 and flake8 testing to check syntax of your codes.</p>

<p>For more about tox and flake8, refer the official documentations.</p>

<ul>
  <li><a href="http://tox.readthedocs.org/en/latest/">tox documentation</a></li>
  <li><a href="https://pypi.python.org/pypi/flake8">flake8</a></li>
</ul>

<h1 id="conclusion-1">Conclusion</h1>
<p>It’s over.</p>

<p>If you have some question or want to point out my mistake please Contact me on <a href="http://twitter.com/itsphilipmutua">twitter</a>. I’ll answer and fix this page as soon as I can.</p>

<p>For more detail about git, refer the <a href="http://git-scm.com/">git official site</a>.</p>

<p>Find out more by <a href="https://github.com/go">visiting the project on GitHub</a>.</p>

