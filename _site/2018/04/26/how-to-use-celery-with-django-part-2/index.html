<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __


 :::    ::: :::   ::: :::::::::  :::::::::: :::::::::  :::    ::: :::   ::: :::        :::        
 :+:    :+: :+:   :+: :+:    :+: :+:        :+:    :+: :+:    :+: :+:   :+: :+:        :+:        
 +:+    +:+  +:+ +:+  +:+    +:+ +:+        +:+    +:+ +:+    +:+  +:+ +:+  +:+        +:+        
 +#++:++#++   +#++:   +#+    +:+ +#++:++#   +#++:++#+  +#++:++#++   +#++:   +#+        +#+        
 +#+    +#+    +#+    +#+    +#+ +#+        +#+        +#+    +#+    +#+    +#+        +#+        
 #+#    #+#    #+#    #+#    #+# #+#        #+#        #+#    #+#    #+#    #+#        #+#        
 ###    ###    ###    #########  ########## ###        ###    ###    ###    ########## ##########
 
This is a Modified version I tweeked <https://github.com/pmutua> 

>



-->





  <link rel="stylesheet" href="/assets/css/main.css">

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">


  
<!-- Begin Jekyll SEO tag v2.4.0 -->
<title>How to Use Celery and RabbitMQ with Django - PART 2 | Philip Mutua</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="How to Use Celery and RabbitMQ with Django - PART 2" />
<meta name="author" content="Philip Mutua" />
<meta property="og:locale" content="en" />
<meta name="description" content="Continuation." />
<meta property="og:description" content="Continuation." />
<link rel="canonical" href="http://docs.celeryproject.org/en/latest/getting-started/brokers/rabbitmq.html" />
<meta property="og:url" content="http://docs.celeryproject.org/en/latest/getting-started/brokers/rabbitmq.html" />
<meta property="og:site_name" content="Philip Mutua" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-04-26T00:00:00+03:00" />
<script type="application/ld+json">
{"description":"Continuation.","author":{"@type":"Person","name":"Philip Mutua"},"@type":"BlogPosting","url":"http://docs.celeryproject.org/en/latest/getting-started/brokers/rabbitmq.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/icons/icon.png"},"name":"Philip Mutua"},"headline":"How to Use Celery and RabbitMQ with Django - PART 2","dateModified":"2018-04-26T00:00:00+03:00","datePublished":"2018-04-26T00:00:00+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://docs.celeryproject.org/en/latest/getting-started/brokers/rabbitmq.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  

  
    <meta name="keywords" content="">
  


<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Philip Mutua">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<meta name="application-name" content="Philip Mutua">
<meta name="msapplication-config" content="/assets/ieconfig.xml">


<meta name="theme-color" content="#268bd2">


<meta name="generator" content="Philip Mutua | Software Engineer">

<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Philip Mutua" />



<link rel="alternate" href="http://localhost:4000/2018/04/26/how-to-use-celery-with-django-part-2/" hreflang="en">

<link rel="shortcut icon" href="/assets/icons/favicon.ico">
<link rel="apple-touch-icon" href="/assets/icons/apple-icon-114x114.png">

<link rel="manifest" href="/assets/manifest.json">


  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">







<link id="_katexJS"  rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.js">
<link id="_katexCSS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css">

<script>
  function stdOnEnd(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function ieOnEnd(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}window.setRelStylesheet=function(n){function e(){this.rel="stylesheet"}var o=document.getElementById(n);o.addEventListener?o.addEventListener("load",e,!1):o.onload=e},window._loaded=!1,window.loadJSDeferred=function(n,e){function o(){window._loaded=!0;var o=document.createElement("script");o.src=n,e&&(("onload"in o?stdOnEnd:ieOnEnd)(o,e),o.onload||stdOnEnd(o,e));var t=document.scripts[0];t.parentNode.insertBefore(o,t)}window._loaded?o():window.addEventListener?window.addEventListener("load",o,!1):window.onload=o};
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);

  window._noPushState = false;
  window._noDrawer = false;
</script>

<!--[if gt IE 8]><!-->


<script>
  WebFontConfig = {
    
    google: {
      families: ['Roboto+Slab:700','Noto+Sans:400,400i,700,700i']
    },
    

    custom: {
      families: ['icomoon'],
      urls: ['/assets/icomoon/style.css']
    }
  };
  (function(d) {
    var wf = d.createElement('script'), s = d.scripts[0];
    wf.src = "/assets/bower_components/webfontloader/webfontloader.js";
    s.parentNode.insertBefore(wf, s);
  }(document));
</script>
<!--<![endif]-->

<noscript>
  
  

  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i">
    <style>
      html { font-family: Noto Sans, Helvetica, Arial, sans-serif }
      h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: Roboto Slab, Helvetica, Arial, sans-serif }
    </style>
  

  <link rel="stylesheet" href="/assets/icomoon/style.css">
</noscript>

<!--[if gt IE 8]><!-->



  <link rel="stylesheet" href="/assets/css/hydejack-7.5.0.css">



<style id="_pageStyle">

.content a:not(.btn){color:#268bd2;border-color:rgba(38,139,210,0.2)}.content a:not(.btn):hover{border-color:#268bd2}:focus{outline-color:#268bd2}.btn-primary{color:#fff;background-color:#268bd2;border-color:#268bd2}.btn-primary:focus,.btn-primary.focus{box-shadow:0 0 0 3px rgba(38,139,210,0.5)}.btn-primary:hover,.btn-primary.hover{color:#fff;background-color:#2076b2;border-color:#2076b2}.btn-primary:disabled,.btn-primary.disabled{color:#fff;background-color:#268bd2;border-color:#268bd2}.btn-primary:active,.btn-primary.active{color:#fff;background-color:#2076b2;border-color:#2076b2}::selection{color:#fff;background:#268bd2}::-moz-selection{color:#fff;background:#268bd2}

</style>

<!--<![endif]-->




  
  <div class="navbar fixed-top">
  <div class="content">
    <div class="nav-btn-bar">
      <span class="sr-only">Jump to:</span>
      <a id="_menu" class="nav-btn no-hover" href="#_navigation">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
    </div>
  </div>
</div>


<hy-push-state>
  <main
    id="_main"
    class="content fade-in layout-post"
    role="main"
    data-color="#268bd2"
    data-theme-color=""
    
      data-background="#202020"
      
    
    >
    


<article id="post-2018-04-26-how-to-use-celery-with-django-part-2" class="page post" role="article">
  <header>
    <h1 class="post-title">
      
        How to Use Celery and RabbitMQ with Django - PART 2
      
    </h1>

    <p class="post-date heading">
      
      <time datetime="2018-04-26T00:00:00+03:00">26 Apr 2018</time>
      
      
      
      
      











      









on <a href="/tag/tutorial/" class="flip-title">Tutorials</a>, <a href="/tag/blog/" class="flip-title">Blog</a>

    </p>

    



  
    <p class="message" >
      Continuation.

    </p>
  


  </header>

  
    <h2 id="table-of-contents">Table of Contents</h2>
<ul>
	<li>Installing RabbitMQ on Windows and Other OSs</li>
	<li>Celery Basic Setup</li>
	<li>Creating Our First Celery Task</li>
	<li>Starting The Worker Process</li>
	<li>Managing The Worker Process in Production with Supervisor</li>
</ul>

<h1 id="installing-rabbitmq-on-windows-and-other-oss">Installing RabbitMQ on Windows and Other OSs</h1>
<p>Unfortunately I don’t have access to a Windows computer to try things out, but you can find the installation guide for <a href="https://www.rabbitmq.com/install-windows.html">Windows on RabbitMQ’s Website</a>.</p>

<p>For other operating systems, check the Downloading and Installing <a href="https://www.rabbitmq.com/download.html">RabbitMQ on their Website</a>.</p>

<h1 id="celery-basic-setup">Celery Basic Setup</h1>
<p>First, consider the following Django project named mysite with an app named core:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	mysite/
	 |-- mysite/
	 |    |-- core/
	 |    |    |-- migrations/
	 |    |    |-- templates/
	 |    |    |-- apps.py
	 |    |    |-- models.py
	 |    |    +-- views.py
	 |    |-- templates/
	 |    |-- __init__.py
	 |    |-- settings.py
	 |    |-- urls.py
	 |    +-- wsgi.py
	 |-- manage.py
	 +-- requirements.txt

</code></pre></div></div>

<p>Add the <code class="highlighter-rouge">CELERY_BROKER_URL</code> configuration to the <code class="highlighter-rouge">settings.py</code> file:</p>

<p><code class="highlighter-rouge">settings.py</code></p>

<p><code class="highlighter-rouge">CELERY_BROKER_URL = 'amqp://localhost'</code>
Alongside with the <code class="highlighter-rouge">settings.py</code> and <code class="highlighter-rouge">urls.py</code> files, let’s create a new file named</p>

<p><strong>celery.py</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="kn">import</span> <span class="nn">os</span>
	<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>

	<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">'DJANGO_SETTINGS_MODULE'</span><span class="p">,</span> <span class="s">'mysite.settings'</span><span class="p">)</span>

	<span class="n">app</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s">'mysite'</span><span class="p">)</span>
	<span class="n">app</span><span class="o">.</span><span class="n">config_from_object</span><span class="p">(</span><span class="s">'django.conf:settings'</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">'CELERY'</span><span class="p">)</span>
	<span class="n">app</span><span class="o">.</span><span class="n">autodiscover_tasks</span><span class="p">()</span>
</code></pre></div></div>

<p>Now edit the <code class="highlighter-rouge">__init__.py</code> file in the project root:</p>

<p><code class="highlighter-rouge">__init__.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">.celery</span> <span class="kn">import</span> <span class="n">app</span> <span class="k">as</span> <span class="n">celery_app</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">'celery_app'</span><span class="p">]</span>

</code></pre></div></div>

<p>This will make sure our Celery app is important every time Django starts.</p>

<hr />

<h1 id="creating-our-first-celery-task">Creating Our First Celery Task</h1>
<p>We can create a file named tasks.py inside a Django app and put all our Celery tasks into this file. The Celery app we created in the project root will collect all tasks defined across all Django apps listed in the <code class="highlighter-rouge">INSTALLED_APPS</code> configuration.</p>

<p>Just for testing purpose, let’s create a Celery task that generates a number of random User accounts.</p>

<p><code class="highlighter-rouge">core/tasks.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">string</span>

<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.utils.crypto</span> <span class="kn">import</span> <span class="n">get_random_string</span>

<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">shared_task</span>

<span class="nd">@shared_task</span>
<span class="k">def</span> <span class="nf">create_random_user_accounts</span><span class="p">(</span><span class="n">total</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="s">'user_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">get_random_string</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">))</span>
        <span class="n">email</span> <span class="o">=</span> <span class="s">'{}@example.com'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">get_random_string</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">'{} random users created with success!'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
<span class="n">The</span> <span class="n">important</span> <span class="n">bits</span> <span class="n">here</span> <span class="n">are</span><span class="p">:</span>

<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">shared_task</span>

<span class="nd">@shared_task</span>
<span class="k">def</span> <span class="nf">name_of_your_function</span><span class="p">(</span><span class="n">optional_param</span><span class="p">):</span>
    <span class="k">pass</span>  <span class="c"># do something heavy</span>
<span class="n">Then</span> <span class="n">I</span> <span class="n">defined</span> <span class="n">a</span> <span class="n">form</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">view</span> <span class="n">to</span> <span class="n">process</span> <span class="n">my</span> <span class="n">Celery</span> <span class="n">task</span><span class="p">:</span>

<span class="n">forms</span><span class="o">.</span><span class="n">py</span>

<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.core.validators</span> <span class="kn">import</span> <span class="n">MinValueValidator</span><span class="p">,</span> <span class="n">MaxValueValidator</span>

<span class="k">class</span> <span class="nc">GenerateRandomUserForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span>
        <span class="n">validators</span><span class="o">=</span><span class="p">[</span>
            <span class="n">MinValueValidator</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
            <span class="n">MaxValueValidator</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

</code></pre></div></div>

<p>Then your view:</p>

<p><strong>views.py</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">messages</span>
<span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">FormView</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>

<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">GenerateRandomUserForm</span>
<span class="kn">from</span> <span class="nn">.tasks</span> <span class="kn">import</span> <span class="n">create_random_user_accounts</span>

<span class="k">class</span> <span class="nc">GenerateRandomUserView</span><span class="p">(</span><span class="n">FormView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'core/generate_random_users.html'</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">GenerateRandomUserForm</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'total'</span><span class="p">)</span>
        <span class="n">create_random_user_accounts</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="s">'We are generating your random users! Wait a moment and refresh this page.'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'users_list'</span><span class="p">)</span>

</code></pre></div></div>

<p>The important bit is here:</p>

<p><code class="highlighter-rouge">create_random_user_accounts.delay(total)</code></p>

<p>Instead of calling the <code class="highlighter-rouge">create_random_user_accounts</code> directly, I’m calling <code class="highlighter-rouge">create_random_user_accounts.delay()</code>. This way we are instructing Celery to execute this function in the background.</p>

<p>Then Django keep processing my view <code class="highlighter-rouge">GenerateRandomUserView</code> and returns smoothly to the user.</p>

<p>But before you try it, check the next section to learn how to start the Celery worker process.</p>

<h1 id="starting-the-worker-process">Starting The Worker Process</h1>
<p>Open a new terminal tab, and run the following command:</p>

<p><code class="highlighter-rouge">celery -A mysite worker -l info</code></p>

<p>Now we can test it. I submitted 500 in my form to create 500 random users.</p>

<p>The response is immediate:</p>

<p>Meanwhile, checking the Celery Worker Process:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>2017-08-20 19:11:17,485: INFO/MainProcess] Received task:
mysite.core.tasks.create_random_user_accounts[8799cfbd-deae-41aa-afac-95ed4cc859b0]

</code></pre></div></div>

<p>Then after a few seconds, if we refresh the page, the users are there:</p>

<p>If we check the Celery Worker Process again, we can see it completed the execution:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>2017-08-20 19:11:45,721: INFO/ForkPoolWorker-2] Task
mysite.core.tasks.create_random_user_accounts[8799cfbd-deae-41aa-afac-95ed4cc859b0] succeeded <span class="k">in
</span>28.225658523035236s: <span class="s1">'500 random users created with success!'</span>

</code></pre></div></div>

<h1 id="managing-the-worker-process-in-production-with-supervisor">Managing The Worker Process in Production with Supervisor</h1>
<p>If you are deploying your application to a VPS like <a href="https://m.do.co/c/074832454ff1">DigitalOcean</a> you will want to run the worker process in the background. In my tutorials I like to use Supervisord to manage the Gunicorn workers, so it’s usually a nice fit with Celery.</p>

<p>First install it (on Ubuntu):</p>

<p><code class="highlighter-rouge">sudo apt-get install supervisor</code>
Then create a file named <strong>mysite-celery.conf</strong> in the folder: <strong>/etc/supervisor/conf.d/mysite-celery.conf</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>program:mysite-celery]
<span class="nb">command</span><span class="o">=</span>/home/mysite/bin/celery worker <span class="nt">-A</span> mysite <span class="nt">--loglevel</span><span class="o">=</span>INFO
<span class="nv">directory</span><span class="o">=</span>/home/mysite/mysite
<span class="nv">user</span><span class="o">=</span>nobody
<span class="nv">numprocs</span><span class="o">=</span>1
<span class="nv">stdout_logfile</span><span class="o">=</span>/home/mysite/logs/celery.log
<span class="nv">stderr_logfile</span><span class="o">=</span>/home/mysite/logs/celery.log
<span class="nv">autostart</span><span class="o">=</span><span class="nb">true
</span><span class="nv">autorestart</span><span class="o">=</span><span class="nb">true
</span><span class="nv">startsecs</span><span class="o">=</span>10

<span class="p">;</span> Need to <span class="nb">wait </span><span class="k">for </span>currently executing tasks to finish at shutdown.
<span class="p">;</span> Increase this <span class="k">if </span>you have very long running tasks.
stopwaitsecs <span class="o">=</span> 600

<span class="nv">stopasgroup</span><span class="o">=</span><span class="nb">true</span>

<span class="p">;</span> Set Celery priority higher than default <span class="o">(</span>999<span class="o">)</span>
<span class="p">;</span> so, <span class="k">if </span>rabbitmq is supervised, it will start first.
<span class="nv">priority</span><span class="o">=</span>1000

</code></pre></div></div>

<p>In the example below, I’m considering my Django project is inside a virtual environment. The path to my virtual environment is <strong>/home/mysite/</strong>.</p>

<p>Now reread the configuration and add the new process:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>supervisorctl reread
<span class="nb">sudo </span>supervisorctl update
</code></pre></div></div>
<p>If you are not familiar with deploying Django to a production server and working with Supervisor, maybe this part will make more sense if you check this post from the blog: <a href="https://simpleisbetterthancomplex.com/tutorial/2016/10/14/how-to-deploy-to-digital-ocean.html">How to Deploy a Django Application to Digital Ocean</a>.</p>


  
</article>


<hr class="dingbat related" />




  
     


  <aside class="about related mt4 mb4" role="complementary">
    
    

<div class="author mt4">
  

  
    
  

  

  
  <img
    src="/assets/img/sidebar-bg.jpg"
    class="avatar"
    alt="Philip Mutua"
    srcset="/assets/img/prof.jpeg 1x,/assets/img/prof.jpeg 2x"
    
    
  />


  

  
  
  <h2  class="page-title hr">
    About
  </h2>

  <p>Hi, I’m <a href="https://twitter.com/itsphilipmutua">Philip</a> and I am a Software Engineer based in Nairobi, KE.</p>

<p>Currently I’m building APIs for Xelpha Health as a Back End Engineer with Python + Django and also providing support when deploying apps with Docker and AWS.</p>


  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  

  

  
    













<li>
  <a href="https://twitter.com/itsphilipmutua" title="Twitter" class="no-mark-external">
    <span class="icon-twitter"></span>
    <span class="sr-only">Twitter</span>
  </a>
</li>

  
    













<li>
  <a href="https://github.com/pmutua" title="GitHub" class="no-mark-external">
    <span class="icon-github"></span>
    <span class="sr-only">GitHub</span>
  </a>
</li>

  
</ul>

  </div>
</div>

  </aside>


  

  
  

  
    




<aside class="related mb4" role="complementary">
  <h2 class="hr">Related Posts</h2>

  <ul class="related-posts">
    
      


<li>
  <a href="/2018/06/18/Set-Up-Virtual-Env/" class="h4 flip-title">
    <span>Setting Up a Virtual Environment in Python.</span>
  </a>
  <time class="heading faded fine" datetime="2018-06-18T00:00:00+03:00">18 Jun 2018</time>
</li>

    
      


<li>
  <a href="/2018/06/04/documenting-your-django-application-with-sphinx/" class="h4 flip-title">
    <span>Documenting Your Django Application with Sphinx.</span>
  </a>
  <time class="heading faded fine" datetime="2018-06-04T00:00:00+03:00">04 Jun 2018</time>
</li>

    
      


<li>
  <a href="/2018/06/03/How-To-Install-and-Use-Docker-on-Ubuntu-16.04-.md/" class="h4 flip-title">
    <span>How To Install and Use Docker on Ubuntu 16.04</span>
  </a>
  <time class="heading faded fine" datetime="2018-06-03T00:00:00+03:00">03 Jun 2018</time>
</li>

    
  </ul>
</aside>


  


    


    <footer role="contentinfo">
  <hr/>
  
    <p><small class="copyright">© 2017. All rights reserved.
</small></p>
  
  
  <p><small>Powered by <a class="external" href="https://jekyllrb.com/">Jekyll</a> v<span id="_version">3.7.2 </span>
      developed by <a class="external" href="https://twitter.com/itsphilipmutua"/>Philip Mutua</a></small></p>
  <hr class="sr-only"/>
</footer>

  </main>
  <hy-drawer>
  <header id="_sidebar" class="sidebar" role="banner">
    
    <div class="sidebar-bg " style="background:#202020"></div>

    <div class="sidebar-sticky">
      <div class="sidebar-about">
        <h2 class="h1"><a href="/">Philip Mutua</a></h2>
        
        
          <p class="">
            Building solutions with code.

          </p>
        
      </div>

      <nav class="sidebar-nav heading" role="navigation">
        <span class="sr-only">Navigation:</span>
<ul>
  
  
  
  
    
      <li>
        <a
          id="_navigation"
          href="/tag/blog/"
          class="sidebar-nav-item"
          
          >
          Blog
        </a>
      </li>
    
  
    
      <li>
        <a
          
          href="/tag/tutorial/"
          class="sidebar-nav-item"
          
          >
          Tutorials
        </a>
      </li>
    
  
    
      <li>
        <a
          
          href="/projects/"
          class="sidebar-nav-item"
          
          >
          Portfolio*
        </a>
      </li>
    
  
    
      <li>
        <a
          
          href="/about/"
          class="sidebar-nav-item"
          
          >
          About
        </a>
      </li>
    
  
</ul>

      </nav>

      

      <div class="sidebar-social">
        <span class="sr-only">Social:</span>
<ul>
  

  

  
    













<li>
  <a href="https://twitter.com/itsphilipmutua" title="Twitter" class="no-mark-external">
    <span class="icon-twitter"></span>
    <span class="sr-only">Twitter</span>
  </a>
</li>

  
    













<li>
  <a href="https://github.com/pmutua" title="GitHub" class="no-mark-external">
    <span class="icon-github"></span>
    <span class="sr-only">GitHub</span>
  </a>
</li>

  
</ul>

      </div>
    </div>
  </header>
</hy-drawer>

</hy-push-state>


  

  <!--[if gt IE 9]><!-->
  
  <script>loadJSDeferred('/assets/js/hydejack-7.5.0.js');</script>
  
  <!--<![endif]-->



  
<hr class="sr-only"/>
<h2 class="sr-only">Templates (for web app):</h2>

<template id="_animation-template">
  <div class="animation-main fixed-top">
    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

<template id="_loading-template">
  <div class="loading">
    <span class="sr-only">Loading…</span>
    <span class="icon-cog"></span>
  </div>
</template>

<template id="_error-template">
  <div class="page">
    <h1 class="page-title">Error</h1>
    
    
    <p class="lead">
      Sorry, an error occurred while loading <a class="this-link" href=""></a>.

    </p>
  </div>
</template>

<template id="_back-template">
  <a id="_back" class="back nav-btn no-hover">
    <span class="sr-only">Back</span>
    <span class="icon-arrow-left2"></span>
  </a>
</template>

<template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="icon-link"></span>
  </a>
</template>












  </html>
