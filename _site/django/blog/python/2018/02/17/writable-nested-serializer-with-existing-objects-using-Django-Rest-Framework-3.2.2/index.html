<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __


 :::    ::: :::   ::: :::::::::  :::::::::: :::::::::  :::    ::: :::   ::: :::        :::        
 :+:    :+: :+:   :+: :+:    :+: :+:        :+:    :+: :+:    :+: :+:   :+: :+:        :+:        
 +:+    +:+  +:+ +:+  +:+    +:+ +:+        +:+    +:+ +:+    +:+  +:+ +:+  +:+        +:+        
 +#++:++#++   +#++:   +#+    +:+ +#++:++#   +#++:++#+  +#++:++#++   +#++:   +#+        +#+        
 +#+    +#+    +#+    +#+    +#+ +#+        +#+        +#+    +#+    +#+    +#+        +#+        
 #+#    #+#    #+#    #+#    #+# #+#        #+#        #+#    #+#    #+#    #+#        #+#        
 ###    ###    ###    #########  ########## ###        ###    ###    ###    ########## ##########
 
This is a Modified version I tweeked <https://github.com/pmutua> 

>



-->





  <link rel="stylesheet" href="/assets/css/main.css">

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">


  
<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Writable nested serializer with existing objects using Django Rest Framework 3.2.2” | Philip Mutua</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Writable nested serializer with existing objects using Django Rest Framework 3.2.2”" />
<meta name="author" content="Philip Mutua" />
<meta property="og:locale" content="en" />
<meta name="description" content="django-rest-framework 3.0 create or update in nested serializer" />
<meta property="og:description" content="django-rest-framework 3.0 create or update in nested serializer" />
<link rel="canonical" href="http://localhost:4000/django/blog/python/2018/02/17/writable-nested-serializer-with-existing-objects-using-Django-Rest-Framework-3.2.2/" />
<meta property="og:url" content="http://localhost:4000/django/blog/python/2018/02/17/writable-nested-serializer-with-existing-objects-using-Django-Rest-Framework-3.2.2/" />
<meta property="og:site_name" content="Philip Mutua" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-02-17T00:00:00+03:00" />
<script type="application/ld+json">
{"description":"django-rest-framework 3.0 create or update in nested serializer","author":{"@type":"Person","name":"Philip Mutua"},"@type":"BlogPosting","url":"http://localhost:4000/django/blog/python/2018/02/17/writable-nested-serializer-with-existing-objects-using-Django-Rest-Framework-3.2.2/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/icons/icon.png"},"name":"Philip Mutua"},"headline":"Writable nested serializer with existing objects using Django Rest Framework 3.2.2”","dateModified":"2018-02-17T00:00:00+03:00","datePublished":"2018-02-17T00:00:00+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/django/blog/python/2018/02/17/writable-nested-serializer-with-existing-objects-using-Django-Rest-Framework-3.2.2/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  

  
    <meta name="keywords" content="django,gh-pages,website,blog,easy">
  


<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Philip Mutua">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<meta name="application-name" content="Philip Mutua">
<meta name="msapplication-config" content="/assets/ieconfig.xml">


<meta name="theme-color" content="#4fb1ba">


<meta name="generator" content="Philip Mutua | Software Engineer">

<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Philip Mutua" />



<link rel="alternate" href="http://localhost:4000/django/blog/python/2018/02/17/writable-nested-serializer-with-existing-objects-using-Django-Rest-Framework-3.2.2/" hreflang="en">

<link rel="shortcut icon" href="/assets/icons/favicon.ico">
<link rel="apple-touch-icon" href="/assets/icons/icon.png">

<link rel="manifest" href="/assets/manifest.json">


  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">







<link id="_katexJS"  rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.js">
<link id="_katexCSS" rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css">

<script>
  function stdOnEnd(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function ieOnEnd(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}window.setRelStylesheet=function(n){function e(){this.rel="stylesheet"}var o=document.getElementById(n);o.addEventListener?o.addEventListener("load",e,!1):o.onload=e},window._loaded=!1,window.loadJSDeferred=function(n,e){function o(){window._loaded=!0;var o=document.createElement("script");o.src=n,e&&(("onload"in o?stdOnEnd:ieOnEnd)(o,e),o.onload||stdOnEnd(o,e));var t=document.scripts[0];t.parentNode.insertBefore(o,t)}window._loaded?o():window.addEventListener?window.addEventListener("load",o,!1):window.onload=o};
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);

  window._noPushState = false;
  window._noDrawer = false;
</script>

<!--[if gt IE 8]><!-->


<script>
  WebFontConfig = {
    
    google: {
      families: ['Roboto+Slab:700','Noto+Sans:400,400i,700,700i']
    },
    

    custom: {
      families: ['icomoon'],
      urls: ['/assets/icomoon/style.css']
    }
  };
  (function(d) {
    var wf = d.createElement('script'), s = d.scripts[0];
    wf.src = "/assets/bower_components/webfontloader/webfontloader.js";
    s.parentNode.insertBefore(wf, s);
  }(document));
</script>
<!--<![endif]-->

<noscript>
  
  

  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i">
    <style>
      html { font-family: Noto Sans, Helvetica, Arial, sans-serif }
      h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: Roboto Slab, Helvetica, Arial, sans-serif }
    </style>
  

  <link rel="stylesheet" href="/assets/icomoon/style.css">
</noscript>

<!--[if gt IE 8]><!-->



  <link rel="stylesheet" href="/assets/css/hydejack-7.5.0.css">



<style id="_pageStyle">

.content a:not(.btn){color:#4fb1ba;border-color:rgba(79,177,186,0.2)}.content a:not(.btn):hover{border-color:#4fb1ba}:focus{outline-color:#4fb1ba}.btn-primary{color:#fff;background-color:#4fb1ba;border-color:#4fb1ba}.btn-primary:focus,.btn-primary.focus{box-shadow:0 0 0 3px rgba(79,177,186,0.5)}.btn-primary:hover,.btn-primary.hover{color:#fff;background-color:#409ba3;border-color:#409ba3}.btn-primary:disabled,.btn-primary.disabled{color:#fff;background-color:#4fb1ba;border-color:#4fb1ba}.btn-primary:active,.btn-primary.active{color:#fff;background-color:#409ba3;border-color:#409ba3}::selection{color:#fff;background:#4fb1ba}::-moz-selection{color:#fff;background:#4fb1ba}

</style>

<!--<![endif]-->




  
  <div class="navbar fixed-top">
  <div class="content">
    <div class="nav-btn-bar">
      <span class="sr-only">Jump to:</span>
      <a id="_menu" class="nav-btn no-hover" href="#_navigation">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
    </div>
  </div>
</div>


<hy-push-state>
  <main
    id="_main"
    class="content fade-in layout-post"
    role="main"
    data-color="#4fb1ba"
    data-theme-color=""
    
      data-image="/assets/img/sidebar-bg.jpg"
      data-overlay
    
    >
    


<article id="post-django-blog-python-2018-02-17--writable -nested- serializer-with- existing-objects- using-Django-Rest-Framework- 3.2.2 " class="page post" role="article">
  <header>
    <h1 class="post-title">
      
        Writable nested serializer with existing objects using Django Rest Framework 3.2.2”
      
    </h1>

    <p class="post-date heading">
      
      <time datetime="2018-02-17T00:00:00+03:00">17 Feb 2018</time>
      
      
      
      
      









in <span>Django</span> / <span>Blog</span> / <span>Python</span>

      









on <span>Django</span>, <a href="/tag/blog/" class="flip-title">Blog</a>, <a href="/tag/tutorial/" class="flip-title">Tutorials</a>, <span>Nested-serializers</span>

    </p>

    



  
    <p class="message" >
      django-rest-framework 3.0 create or update in nested serializer

    </p>
  


  </header>

  
    <p>Firstly, do you want to support creating new book instances, or only updating existing ones?</p>

<p>If you only ever wanted to create new book instances you could do something like this…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PageSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BookSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">PageSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="c"># Create the book instance</span>
        <span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">validated_data</span><span class="p">[</span><span class="s">'title'</span><span class="p">])</span>

        <span class="c"># Create or update each page instance</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">validated_data</span><span class="p">[</span><span class="s">'pages'</span><span class="p">]:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s">'page_id'</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s">'text'</span><span class="p">],</span> <span class="n">book</span><span class="o">=</span><span class="n">book</span><span class="p">)</span>
            <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">book</span>
</code></pre></div></div>

<p>Note that I haven’t included the book_id here. When we’re creating book instances we won’t be including a book id. When we’re updating book instances we’ll typically include the book id as part of the URL, rather than in the request data.</p>

<p>If you want to support both create and update of book instances then you need to think about how you want to handle pages that are not included in the request, but are currently associated with the book instance.</p>

<p>You might choose to silently ignore those pages and leave them as they are, you might want to raise a validation error, or you might want to delete them.</p>

<p>Let’s assume that you want to delete any pages not included in the request.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
    <span class="c"># As before.</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
    <span class="c"># Update the book instance</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">validated_data</span><span class="p">[</span><span class="s">'title'</span><span class="p">]</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c"># Delete any pages not included in the request</span>
    <span class="n">page_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s">'page_id'</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">validated_data</span><span class="p">[</span><span class="s">'pages'</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">books</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="nb">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">page_ids</span><span class="p">:</span>
            <span class="n">page</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="c"># Create or update page instances that are in the request</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">validated_data</span><span class="p">[</span><span class="s">'pages'</span><span class="p">]:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s">'page_id'</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s">'text'</span><span class="p">],</span> <span class="n">book</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">page</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">instance</span>

</code></pre></div></div>

<p>It’s also possible that you might want to only support book updates, and not support creation, in which case, only include the update() method.</p>

<p>There are also various ways you could reduce the number of queries eg. using bulk create/deletion, but the above would do the job in a fairly straightforward way.</p>

<p>As you can see there are subtleties in the types of behavior you might want when dealing with nested data, so think carefully about exactly what behavior you’re expecting in various cases.</p>

<p>Also note that I’ve been using <code class="highlighter-rouge">Serializer</code> in the above example rather than <code class="highlighter-rouge">ModelSerializer</code>. In this case it’s simpler just to include all the fields in the serializer class explicitly, rather than relying on the automatic set of fields that <code class="highlighter-rouge">ModelSerializer</code> generates by default.</p>

  
</article>


<hr class="dingbat related" />




  
     


  <aside class="about related mt4 mb4" role="complementary">
    
    

<div class="author mt4">
  

  
    
  

  

  
  <img
    src="/assets/img/sidebar-bg.jpg"
    class="avatar"
    alt="Philip Mutua"
    srcset="/assets/img/sidebar-bg.jpg 1x,/assets/img/sidebar-bg.jpg 2x"
    
    
  />


  

  
  
  <h2  class="page-title hr">
    About
  </h2>

  <p>Hi, I’m <a href="https://twitter.com/itsphilipmutua">Philip</a> and I am a Software Engineer based in Nairobi, KENYA.</p>

<p>Currently I’m working at Xelpha Health as a Back End Engineer building E-Health solutions. My specialialty is with Python and  Django.</p>


  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  

  

  
    













<li>
  <a href="https://twitter.com/itsphilipmutua" title="Twitter" class="no-mark-external">
    <span class="icon-twitter"></span>
    <span class="sr-only">Twitter</span>
  </a>
</li>

  
    













<li>
  <a href="https://github.com/pmutua" title="GitHub" class="no-mark-external">
    <span class="icon-github"></span>
    <span class="sr-only">GitHub</span>
  </a>
</li>

  
</ul>

  </div>
</div>

  </aside>


  

  
  

  
    




<aside class="related mb4" role="complementary">
  <h2 class="hr">Related Posts</h2>

  <ul class="related-posts">
    
      


<li>
  <a href="/django%20rest%20framework/django/python/2018/06/16/serialization-in-django-rest-framework/" class="h4 flip-title">
    <span>Getting started with django Rest Framework</span>
  </a>
  <time class="heading faded fine" datetime="2018-06-16T00:00:00+03:00">16 Jun 2018</time>
</li>

    
      


<li>
  <a href="/python/django/2018/05/07/documenting-your-django-application-with-sphinx/" class="h4 flip-title">
    <span>How to start documenting your django application with sphinx</span>
  </a>
  <time class="heading faded fine" datetime="2018-05-07T00:00:00+03:00">07 May 2018</time>
</li>

    
      


<li>
  <a href="/django/python/2018/04/04/how-to-use-celery-with-django/" class="h4 flip-title">
    <span>Table of Contents</span>
  </a>
  <time class="heading faded fine" datetime="2018-04-04T00:00:00+03:00">04 Apr 2018</time>
</li>

    
  </ul>
</aside>


  


    


    <footer role="contentinfo">
  <hr/>
  
    <p><small class="copyright">© 2017. All rights reserved.
</small></p>
  
  
  <p><small>Powered by <a class="external" href="https://jekyllrb.com/">Jekyll</a> v<span id="_version">3.7.2 </span>
      developed by <a class="external" href="https://twitter.com/itsphilipmutua"/>Philip Mutua</a></small></p>
  <hr class="sr-only"/>
</footer>

  </main>
  <hy-drawer>
  <header id="_sidebar" class="sidebar" role="banner">
    
    <div class="sidebar-bg sidebar-overlay" style="background-color:#4fb1ba;background-image:url(/assets/img/sidebar-bg.jpg)"></div>

    <div class="sidebar-sticky">
      <div class="sidebar-about">
        <h2 class="h1"><a href="/">Philip Mutua</a></h2>
        
        
          <p class="">
            Building solutions with code.

          </p>
        
      </div>

      <nav class="sidebar-nav heading" role="navigation">
        <span class="sr-only">Navigation:</span>
<ul>
  
  
  
  
    
      <li>
        <a
          id="_navigation"
          href="/tag/blog/"
          class="sidebar-nav-item"
          
          >
          Blog
        </a>
      </li>
    
  
    
      <li>
        <a
          
          href="/tag/tutorial/"
          class="sidebar-nav-item"
          
          >
          Tutorials
        </a>
      </li>
    
  
    
      <li>
        <a
          
          href="/about/"
          class="sidebar-nav-item"
          
          >
          About
        </a>
      </li>
    
  
</ul>

      </nav>

      

      <div class="sidebar-social">
        <span class="sr-only">Social:</span>
<ul>
  

  

  
    













<li>
  <a href="https://twitter.com/itsphilipmutua" title="Twitter" class="no-mark-external">
    <span class="icon-twitter"></span>
    <span class="sr-only">Twitter</span>
  </a>
</li>

  
    













<li>
  <a href="https://github.com/pmutua" title="GitHub" class="no-mark-external">
    <span class="icon-github"></span>
    <span class="sr-only">GitHub</span>
  </a>
</li>

  
</ul>

      </div>
    </div>
  </header>
</hy-drawer>

</hy-push-state>


  

  <!--[if gt IE 9]><!-->
  
  <script>loadJSDeferred('/assets/js/hydejack-7.5.0.js');</script>
  
  <!--<![endif]-->



  
<hr class="sr-only"/>
<h2 class="sr-only">Templates (for web app):</h2>

<template id="_animation-template">
  <div class="animation-main fixed-top">
    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

<template id="_loading-template">
  <div class="loading">
    <span class="sr-only">Loading…</span>
    <span class="icon-cog"></span>
  </div>
</template>

<template id="_error-template">
  <div class="page">
    <h1 class="page-title">Error</h1>
    
    
    <p class="lead">
      Sorry, an error occurred while loading <a class="this-link" href=""></a>.

    </p>
  </div>
</template>

<template id="_back-template">
  <a id="_back" class="back nav-btn no-hover">
    <span class="sr-only">Back</span>
    <span class="icon-arrow-left2"></span>
  </a>
</template>

<template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="icon-link"></span>
  </a>
</template>












  </html>
