<!DOCTYPE html>
<html class="js" lang="en-us"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <!-- NOJS TOGGLE -->
        <script async="" src="Multiple%20APIs%20documented%20by%20Swagger%20in%20Rails%20-%20Syntax%20Alert_files/analytics.js"></script><script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>

        <!-- META DATA -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <link rel="apple-touch-icon" sizes="57x57" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="192x192" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/favicon-16x16.png">
        <link rel="manifest" href="https://syntaxalert.com/content/themes/oowp/assets/media/favicon/manifest.json">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">

        <!--[if IE]><meta http-equiv="cleartype" content="on" /><![endif]-->
		<link rel="alternate" href="http://syntaxalert.com/" hreflang="en-us">
        <meta property="og:image" content="https://syntaxalert.com/content/themes/oowp/assets/media/images/logo.png">
        <meta property="og:title" content="Multiple APIs documented by Swagger in Rails - Syntax Alert">

        <!-- SEO -->
        <title>
            Multiple APIs documented by Swagger in Rails - Syntax Alert        </title>

        
<!-- This site is optimized with the Yoast SEO plugin v4.0.2 - https://yoast.com/wordpress/plugins/seo/ -->
<link rel="canonical" href="https://syntaxalert.com/multiple-apis-documented-swagger-rails/">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Multiple APIs documented by Swagger in Rails - Syntax Alert">
<meta property="og:description" content="`ruby: 2.2.2` `rails: 4.2.0` `swagger-docs: v0.2.7` I’m currently working on a project where the client is seeking to open up their API to the general public as a service. The API has enough differences from the original to actually warrant creating a completely separate namespace section of the application dedicated to a ‘public_api’. With the …">
<meta property="og:url" content="https://syntaxalert.com/multiple-apis-documented-swagger-rails/">
<meta property="og:site_name" content="Syntax Alert">
<meta property="article:tag" content="documentation">
<meta property="article:tag" content="rails">
<meta property="article:tag" content="rake">
<meta property="article:tag" content="ruby">
<meta property="article:tag" content="swagger">
<meta property="article:section" content="Uncategorized">
<meta property="article:published_time" content="2017-01-25T22:24:05+00:00">
<meta property="article:modified_time" content="2017-01-25T22:33:22+00:00">
<meta property="og:updated_time" content="2017-01-25T22:33:22+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:description" content="`ruby: 2.2.2` `rails: 4.2.0` `swagger-docs: v0.2.7` I’m currently working on a project where the client is seeking to open up their API to the general public as a service. The API has enough differences from the original to actually warrant creating a completely separate namespace section of the application dedicated to a ‘public_api’. With the […]">
<meta name="twitter:title" content="Multiple APIs documented by Swagger in Rails - Syntax Alert">
<meta name="twitter:site" content="@voodoogq">
<meta name="twitter:creator" content="@voodoogq">
<!-- / Yoast SEO plugin. -->

<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="Syntax Alert » Feed" href="https://syntaxalert.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Syntax Alert » Comments Feed" href="https://syntaxalert.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Syntax Alert » Multiple APIs documented by Swagger in Rails Comments Feed" href="https://syntaxalert.com/multiple-apis-documented-swagger-rails/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"wpemoji":"https:\/\/syntaxalert.com\/core\/wp-includes\/js\/wp-emoji.js?ver=4.8-alpha-39657","twemoji":"https:\/\/syntaxalert.com\/core\/wp-includes\/js\/twemoji.js?ver=4.8-alpha-39657"}};
			( function( window, document, settings ) {
	var src, ready, ii, tests;

	/*
	 * Create a canvas element for testing native browser support
	 * of emoji.
	 */
	var canvas = document.createElement( 'canvas' );
	var context = canvas.getContext && canvas.getContext( '2d' );

	/**
	 * Detect if the browser supports rendering emoji or flag emoji. Flag emoji are a single glyph
	 * made of two characters, so some browsers (notably, Firefox OS X) don't support them.
	 *
	 * @since 4.2.0
	 *
	 * @param type {String} Whether to test for support of "flag" or "emoji4" emoji.
	 * @return {Boolean} True if the browser can render emoji, false if it cannot.
	 */
	function browserSupportsEmoji( type ) {
		var stringFromCharCode = String.fromCharCode,
			flag, flag2, technologist, technologist2;

		if ( ! context || ! context.fillText ) {
			return false;
		}

		// Cleanup from previous test.
		context.clearRect( 0, 0, canvas.width, canvas.height );

		/*
		 * Chrome on OS X added native emoji rendering in M41. Unfortunately,
		 * it doesn't work when the font is bolder than 500 weight. So, we
		 * check for bold rendering support to avoid invisible emoji in Chrome.
		 */
		context.textBaseline = 'top';
		context.font = '600 32px Arial';

		switch ( type ) {
			case 'flag':
				/*
				 * This works because the image will be one of three things:
				 * - Two empty squares, if the browser doesn't render emoji
				 * - Two squares with 'U' and 'N' in them, if the browser doesn't render flag emoji
				 * - The United Nations flag
				 *
				 * The first two will encode to small images (1-2KB data URLs), the third will encode
				 * to a larger image (4-5KB data URL).
				 */
				context.fillText( stringFromCharCode( 55356, 56826, 55356, 56819 ), 0, 0 );
				if ( canvas.toDataURL().length < 3000 ) {
					return false;
				}

				context.clearRect( 0, 0, canvas.width, canvas.height );

				/*
				 * Test for rainbow flag compatibility. As the rainbow flag was added out of sequence with
				 * the usual Unicode release cycle, some browsers support it, and some don't, even if their
				 * Unicode support is up to date.
				 *
				 * To test for support, we try to render it, and compare the rendering to how it would look if
				 * the browser doesn't render it correctly (white flag emoji + rainbow emoji).
				 */
				context.fillText( stringFromCharCode( 55356, 57331, 65039, 8205, 55356, 57096 ), 0, 0 );
				flag = canvas.toDataURL();

				context.clearRect( 0, 0, canvas.width, canvas.height );

				context.fillText( stringFromCharCode( 55356, 57331, 55356, 57096 ), 0, 0 );
				flag2 = canvas.toDataURL();

				return flag !== flag2;
			case 'emoji4':
				/*
				 * Emoji 4 has the best technologists. So does WordPress!
				 *
				 * To test for support, try to render a new emoji (woman technologist: medium skin tone),
				 * then compare it to how it would look if the browser doesn't render it correctly
				 * (woman technologist: medium skin tone + personal computer).
				 */
				context.fillText( stringFromCharCode( 55357, 56425, 55356, 57341, 8205, 55357, 56507), 0, 0 );
				technologist = canvas.toDataURL();

				context.clearRect( 0, 0, canvas.width, canvas.height );

				context.fillText( stringFromCharCode( 55357, 56425, 55356, 57341, 55357, 56507), 0, 0 );
				technologist2 = canvas.toDataURL();

				return technologist !== technologist2;
		}

		return false;
	}

	function addScript( src ) {
		var script = document.createElement( 'script' );

		script.src = src;
		script.defer = script.type = 'text/javascript';
		document.getElementsByTagName( 'head' )[0].appendChild( script );
	}

	tests = Array( 'flag', 'emoji4' );

	settings.supports = {
		everything: true,
		everythingExceptFlag: true
	};

	for( ii = 0; ii < tests.length; ii++ ) {
		settings.supports[ tests[ ii ] ] = browserSupportsEmoji( tests[ ii ] );

		settings.supports.everything = settings.supports.everything && settings.supports[ tests[ ii ] ];

		if ( 'flag' !== tests[ ii ] ) {
			settings.supports.everythingExceptFlag = settings.supports.everythingExceptFlag && settings.supports[ tests[ ii ] ];
		}
	}

	settings.supports.everythingExceptFlag = settings.supports.everythingExceptFlag && ! settings.supports.flag;

	settings.DOMReady = false;
	settings.readyCallback = function() {
		settings.DOMReady = true;
	};

	if ( ! settings.supports.everything ) {
		ready = function() {
			settings.readyCallback();
		};

		if ( document.addEventListener ) {
			document.addEventListener( 'DOMContentLoaded', ready, false );
			window.addEventListener( 'load', ready, false );
		} else {
			window.attachEvent( 'onload', ready );
			document.attachEvent( 'onreadystatechange', function() {
				if ( 'complete' === document.readyState ) {
					settings.readyCallback();
				}
			} );
		}

		src = settings.source || {};

		if ( src.concatemoji ) {
			addScript( src.concatemoji );
		} else if ( src.wpemoji && src.twemoji ) {
			addScript( src.twemoji );
			addScript( src.wpemoji );
		}
	}

} )( window, document, window._wpemojiSettings );
		</script><script src="Multiple%20APIs%20documented%20by%20Swagger%20in%20Rails%20-%20Syntax%20Alert_files/twemoji.js" type="text/javascript" defer="defer"></script><script src="Multiple%20APIs%20documented%20by%20Swagger%20in%20Rails%20-%20Syntax%20Alert_files/wp-emoji.js" type="text/javascript" defer="defer"></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="oowp_screen-css" href="Multiple%20APIs%20documented%20by%20Swagger%20in%20Rails%20-%20Syntax%20Alert_files/screen.css" type="text/css" media="screen, projection">
<script type="text/javascript" src="Multiple%20APIs%20documented%20by%20Swagger%20in%20Rails%20-%20Syntax%20Alert_files/jquery.js"></script>
<script type="text/javascript" src="Multiple%20APIs%20documented%20by%20Swagger%20in%20Rails%20-%20Syntax%20Alert_files/jquery-migrate.js"></script>
<link rel="https://api.w.org/" href="https://syntaxalert.com/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://syntaxalert.com/core/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://syntaxalert.com/core/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 4.8-alpha-39657">
<link rel="shortlink" href="https://syntaxalert.com/?p=104">
<link rel="alternate" type="application/json+oembed" href="https://syntaxalert.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsyntaxalert.com%2Fmultiple-apis-documented-swagger-rails%2F">
         <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-89492190-2', 'auto');
            ga('send', 'pageview');
        </script>
    </head>
    <body class="post-template-default single single-post postid-104 single-format-standard" cz-shortcut-listen="true">
        <div class="container container-site">
            
<header class="site-hd">
    <div class="logo vr">SYNTAX ALERT</div>
    <nav class="nav">
		<ul>
			<li>
				<a href="https://syntaxalert.com/" alt="home" title="home" class="icon icon-home"></a>
			</li>
			<li>
				<a href="https://syntaxalert.com/about" alt="about" title="about" class="icon icon-about"></a>
			</li>
			<li>
				<a href="#" alt="Search" title="Search" class="icon icon-search js-searchFormTrigger"></a>
			</li>
		</ul>
		
<div class="container-searchForm js-searchFormContainer isHidden">
    <form action="https://syntaxalert.com/" method="get" role="search" class="searchForm js-searchForm isHidden">
        <input id="s" name="s" type="search">
        <button type="submit" class="fa fa-search"></button> 
        <a href="#" class="fa fa-close close js-searchFormClose"></a>
    </form>
</div>

    </nav>
</header>
            <div class="site-bd">
                <div class="body-inner">
<h1 class="hdg hdg_1 vr_half">Multiple APIs documented by Swagger in Rails</h1>
<div class="date vr_half"><span class="fa fa-calendar"></span> [2017.01.25]</div>
	<ul class="tags vr">
					<li><a href="https://syntaxalert.com/tag/documentation/" class="tag">documentation</a></li>
					<li><a href="https://syntaxalert.com/tag/rails/" class="tag">rails</a></li>
					<li><a href="https://syntaxalert.com/tag/rake/" class="tag">rake</a></li>
					<li><a href="https://syntaxalert.com/tag/ruby/" class="tag">ruby</a></li>
					<li><a href="https://syntaxalert.com/tag/swagger/" class="tag">swagger</a></li>
			</ul>
<div class="userContent vr">
    <p><code>ruby: 2.2.2</code>
<code>rails: 4.2.0</code>
<code>swagger-docs: v0.2.7</code></p>
<p>I'm currently working on a project where the client is seeking to 
open up their API to the general public as a service. The API has enough
 differences from the original to actually warrant creating a completely
 separate namespace section of the application dedicated to a 
'public_api'. With the original API we are using the <a href="https://github.com/richhollis/swagger-docs">swagger-docs</a> gem to generate our API documentation infrastructure, and would like to continue using that for the new public API. </p>
<p>After following the documentation to try and setup a custom 
configuration for the swagger on the new API I ran into nothing but 
issues. The main issue seemed to be that creating a custom class for the
 config didn't appear to matter, at the end of the day it would just 
revert to the default configuration. After doing some spelunking in the 
base library code I came across <a href="https://github.com/richhollis/swagger-docs/blob/master/lib/swagger/docs/generator.rb#L18">this</a>
 which appears to indicate that the library is designed to read the base
 configuration regardless if you send it a custom controller or not. I'm
 going to have to dig some more to verify if this is in fact the case or
 not, and then submit a pull request with a fix if it is, but for now I 
have a deadline and need a work around....</p>
<blockquote>
<p>Fair Warning: This is a hacky approach. It does the job but it's not ideal. If you have a better solution please <a href="mailto:voodoogq@gmail.com">contact me</a> and let me know. I'll update this article with corrected approaches as they become available</p>
</blockquote>
<h2>Routes</h2>
<p>Let's setup the routes first and then we'll build our controller 
methods to match it. This is just basic rails route setups of a couple 
different namespaces. Each will have a match for <code>docs</code> and <code>docs/persist-api-key</code>.
 The latter route will make it possible for users with a valid API key 
to use the API directly in the documentation by validating against 
Devise/oAuth (<em>Note: Devise/oAuth setup is a completely different topic that we won't be covering here.</em>).</p>
<h3><code>config/routes.rb</code></h3>
<pre class=" language-ruby"><code class=" language-ruby">  namespace <span class="token symbol">:api</span> <span class="token keyword">do</span>
    namespace <span class="token symbol">:v1</span> <span class="token keyword">do</span>
      match <span class="token string">'docs'</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token string">'docs#index'</span><span class="token punctuation">,</span> via<span class="token punctuation">:</span> <span class="token symbol">:get</span>
      match <span class="token string">'docs/persist-api-key'</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token string">'docs#persist_api_key'</span><span class="token punctuation">,</span> via<span class="token punctuation">:</span> <span class="token symbol">:post</span>

      <span class="token comment" spellcheck="true"># Your specific API routes go here</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  namespace <span class="token symbol">:public_api</span> <span class="token keyword">do</span>
    namespace <span class="token symbol">:v1</span> <span class="token keyword">do</span>
      match <span class="token string">'docs'</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token string">'docs#index'</span><span class="token punctuation">,</span> via<span class="token punctuation">:</span> <span class="token symbol">:get</span>
      match <span class="token string">'docs/persist-api-key'</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token string">'docs#persist_api_key'</span><span class="token punctuation">,</span> via<span class="token punctuation">:</span> <span class="token symbol">:post</span>

      <span class="token comment" spellcheck="true"># Your specific Public API routes go here</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
</code></pre>
<h2>Config</h2>
<p>Next we'll be creating a <code>config/intializers/swagger_initializer.rb</code> file that will configure both of the API versions. The <code>Swagger::Docs::PublicConfig</code> essentially gets ignored during the initialization as the <code>Swagger::Docs::Config</code> defaults are being used regardless of what you specify in here. Later we'll be creating a piggy back <code>rake</code> task that will utilize this other configuration we're creating. </p>
<p>A couple things to note here. You want to make sure the <code>transform_path</code> in the classes and the <code>:api_file_path</code> in the respective configs are set to different folders from each of the configuration points. The primary <code>api-docs.json</code> file required by swagger will be overwritten if you don't.</p>
<h3><code>config/initializers/swagger_initializer.rb</code></h3>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token class-name">Swagger</span><span class="token punctuation">:</span><span class="token symbol">:Docs</span><span class="token punctuation">:</span><span class="token symbol">:Config</span>
  <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span>base_api_controller<span class="token punctuation">;</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:V1</span><span class="token punctuation">:</span><span class="token symbol">:BaseController</span> <span class="token keyword">end</span>
  <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">transform_path</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> api_version<span class="token punctuation">)</span>
    <span class="token string">"<span class="token interpolation"><span class="token delimiter tag">#{</span>ENV<span class="token punctuation">[</span><span class="token string">'DOMAIN'</span><span class="token punctuation">]</span><span class="token delimiter tag">}</span></span>/docs/internal/<span class="token interpolation"><span class="token delimiter tag">#{</span>path<span class="token delimiter tag">}</span></span>"</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token constant">Swagger</span><span class="token punctuation">:</span><span class="token symbol">:Docs</span><span class="token punctuation">:</span><span class="token symbol">:Config</span><span class="token punctuation">.</span><span class="token function">register_apis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">"1.0"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true"># the extension used for the API</span>
    <span class="token comment" spellcheck="true"># the output location where your .json files are written to</span>
    <span class="token symbol">:api_file_path</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"public/docs/internal"</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># the URL base path to your API</span>
    <span class="token symbol">:base_path</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"<span class="token interpolation"><span class="token delimiter tag">#{</span>ENV<span class="token punctuation">[</span><span class="token string">'DOMAIN'</span><span class="token punctuation">]</span><span class="token delimiter tag">}</span></span>/"</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># if you want to delete all .json files at each generation</span>
    <span class="token symbol">:clean_directory</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># Disable conversion of model properties to camel case</span>
    camelize_model_properties<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># add custom attributes to api-docs</span>
    <span class="token symbol">:attributes</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token symbol">:info</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token string">"title"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"MyApi"</span><span class="token punctuation">,</span>
        <span class="token string">"description"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"An API to interact with."</span><span class="token punctuation">,</span>
        <span class="token string">"termsOfServiceUrl"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"http://mysite.com/terms-of-service"</span><span class="token punctuation">,</span>
        <span class="token string">"contact"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"support@mysite.com"</span><span class="token punctuation">,</span>
        <span class="token string">"license"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"Apache 2.0"</span><span class="token punctuation">,</span>
        <span class="token string">"licenseUrl"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"http://www.apache.org/licenses/LICENSE-2.0.html"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Registration for the Public API swagger documentation generation.</span>
<span class="token comment" spellcheck="true"># Please review lib/tasks/swagger_compile_public_api_docs.rake for more info</span>
<span class="token keyword">class</span> <span class="token class-name">Swagger</span><span class="token punctuation">:</span><span class="token symbol">:Docs</span><span class="token punctuation">:</span><span class="token symbol">:PublicConfig</span> <span class="token operator">&lt;</span> <span class="token constant">Swagger</span><span class="token punctuation">:</span><span class="token symbol">:Docs</span><span class="token punctuation">:</span><span class="token symbol">:Config</span>
  <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span>base_api_controller<span class="token punctuation">;</span> <span class="token constant">PublicApi</span><span class="token punctuation">:</span><span class="token symbol">:V1</span><span class="token punctuation">:</span><span class="token symbol">:BaseController</span> <span class="token keyword">end</span>
  <span class="token keyword">def</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">transform_path</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> api_version<span class="token punctuation">)</span>
    <span class="token string">"<span class="token interpolation"><span class="token delimiter tag">#{</span>ENV<span class="token punctuation">[</span><span class="token string">'DOMAIN'</span><span class="token punctuation">]</span><span class="token delimiter tag">}</span></span>/docs/client/<span class="token interpolation"><span class="token delimiter tag">#{</span>path<span class="token delimiter tag">}</span></span>"</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token constant">Swagger</span><span class="token punctuation">:</span><span class="token symbol">:Docs</span><span class="token punctuation">:</span><span class="token symbol">:PublicConfig</span><span class="token punctuation">.</span><span class="token function">register_apis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">"pub1.0"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true"># the extension used for the API</span>
    <span class="token comment" spellcheck="true"># the output location where your .json files are written to</span>
    <span class="token symbol">:api_file_path</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"public/docs/client"</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># the URL base path to your API</span>
    <span class="token symbol">:base_path</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"<span class="token interpolation"><span class="token delimiter tag">#{</span>ENV<span class="token punctuation">[</span><span class="token string">'DOMAIN'</span><span class="token punctuation">]</span><span class="token delimiter tag">}</span></span>/"</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># if you want to delete all .json files at each generation</span>
    <span class="token symbol">:clean_directory</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># Disable conversion of model properties to camel case</span>
    camelize_model_properties<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true"># add custom attributes to api-docs</span>
    <span class="token symbol">:attributes</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token symbol">:info</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token string">"title"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"MyApi"</span><span class="token punctuation">,</span>
        <span class="token string">"description"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"An API to interact with."</span><span class="token punctuation">,</span>
        <span class="token string">"termsOfServiceUrl"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"http://mysite.com/terms-of-service"</span><span class="token punctuation">,</span>
        <span class="token string">"contact"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"support@mysite.com"</span><span class="token punctuation">,</span>
        <span class="token string">"license"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"Apache 2.0"</span><span class="token punctuation">,</span>
        <span class="token string">"licenseUrl"</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">"http://www.apache.org/licenses/LICENSE-2.0.html"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h2>Rake</h2>
<p>We're going to creating a <code>rake</code> task within the <code>swagger</code> namespace that essentially just copies what's already available <a href="https://github.com/richhollis/swagger-docs/blob/master/lib/tasks/swagger.rake">via the gem</a>. This is the task we will use to generate our public api documentation while the original <code>rake swagger:docs</code> will be used to generate the base level documentation.</p>
<p>This is where things get hacky... essentially what we're going to do is completely override <code>Swagger::Docs::Config</code> with our custom <code>Swagger::Docs::PublicConfig</code>
 configuration we did in the previous step before the documents are 
generated. This is only persistent through the execution of the rake 
task, so there's little if any issues that could come of it, but none 
the less it's gross but seemingly necessary...</p>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token comment" spellcheck="true"># This task is responsible for generating the Public API documentation for</span>
<span class="token comment" spellcheck="true"># the Phoji Saas offering. This addresses an issue with the base level library</span>
<span class="token comment" spellcheck="true"># where custom configuration is not being respected.</span>

namespace <span class="token symbol">:swagger</span> <span class="token keyword">do</span>

  desc <span class="token string">"Generate Swagger documentation files for the public facing API"</span>
  task <span class="token symbol">:public_api_docs</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token symbol">:environment</span><span class="token punctuation">]</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token punctuation">,</span>args<span class="token operator">|</span>
    <span class="token comment" spellcheck="true"># TODO: This isn't ideal obviously, it's rather hacky. For some reason the</span>
    <span class="token comment" spellcheck="true"># swagger library isn't respecting the custom configuration controllers that</span>
    <span class="token comment" spellcheck="true"># it says it does in the README. This fixes that issue.</span>
    <span class="token constant">Swagger</span><span class="token punctuation">:</span><span class="token symbol">:Docs</span><span class="token punctuation">:</span><span class="token symbol">:Config</span> <span class="token operator">=</span> <span class="token constant">Swagger</span><span class="token punctuation">:</span><span class="token symbol">:Docs</span><span class="token punctuation">:</span><span class="token symbol">:PublicConfig</span>
    results <span class="token operator">=</span> <span class="token constant">Swagger</span><span class="token punctuation">:</span><span class="token symbol">:Docs</span><span class="token punctuation">:</span><span class="token symbol">:Generator</span><span class="token punctuation">.</span><span class="token function">write_docs</span><span class="token punctuation">(</span>
      <span class="token constant">Swagger</span><span class="token punctuation">:</span><span class="token symbol">:Docs</span><span class="token punctuation">:</span><span class="token symbol">:Config</span><span class="token punctuation">.</span>registered_apis
    <span class="token punctuation">)</span>
    results<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>k<span class="token punctuation">,</span>v<span class="token operator">|</span>
      puts <span class="token string">"<span class="token interpolation"><span class="token delimiter tag">#{</span>k<span class="token delimiter tag">}</span></span>: <span class="token interpolation"><span class="token delimiter tag">#{</span>v<span class="token punctuation">[</span><span class="token punctuation">:</span>processed<span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token delimiter tag">}</span></span> proc / <span class="token interpolation"><span class="token delimiter tag">#{</span>v<span class="token punctuation">[</span><span class="token punctuation">:</span>skipped<span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token delimiter tag">}</span></span> skipped"</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>
<h2>Controllers</h2>
<p>My controllers for the project are located under <code>app/controllers/api/v1</code> and <code>app/controllers/public_api/v1</code>
 respectively. These very basic doc controllers just create an index 
endpoint and an api key persistence method for when someone wants to use
 the API directly on the doc page:</p>
<h3><code>app/controllers/api/v1/docs_controller.rb</code>:</h3>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token class-name">Api</span><span class="token punctuation">:</span><span class="token symbol">:V1</span><span class="token punctuation">:</span><span class="token symbol">:DocsController</span> <span class="token operator">&lt;</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:V1</span><span class="token punctuation">:</span><span class="token symbol">:BaseController</span>
  layout <span class="token keyword">false</span>
  <span class="token keyword">def</span> index
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> persist_api_key
    session<span class="token punctuation">[</span><span class="token symbol">:swagger_api_key</span><span class="token punctuation">]</span> <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token symbol">:swagger_api_key</span><span class="token punctuation">]</span>
    render nothing<span class="token punctuation">:</span> <span class="token keyword">true</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>
<h3><code>app/controllers/public_api/v1/docs_controller.rb</code>:</h3>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token class-name">PublicApi</span><span class="token punctuation">:</span><span class="token symbol">:V1</span><span class="token punctuation">:</span><span class="token symbol">:DocsController</span> <span class="token operator">&lt;</span> <span class="token constant">Api</span><span class="token punctuation">:</span><span class="token symbol">:V1</span><span class="token punctuation">:</span><span class="token symbol">:BaseController</span>
  layout <span class="token keyword">false</span>
  <span class="token keyword">def</span> index
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> persist_api_key
    session<span class="token punctuation">[</span><span class="token symbol">:swagger_api_key</span><span class="token punctuation">]</span> <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token symbol">:swagger_api_key</span><span class="token punctuation">]</span>
    render nothing<span class="token punctuation">:</span> <span class="token keyword">true</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>
<p>Don't be too concerned with the <code>::V1::BaseController</code> 
inheritance. That's strictly for base configurations I have in regards 
to authentication. Strictly speaking this could be a child of <code>ApplicationController</code> just as well.</p>
<h2>Views</h2>
<p>My views live at <code>views/api/v1/docs</code> and <code>views/public_api/v1/docs</code> respectively. This is the basic index file with styling that Swagger <a href="https://github.com/swagger-api/swagger-ui">recommends you use for displaying your api documents</a>
 just modified for Rails. The index file is rather long, and it's 
essentially exactly the same for both of the different views but there 
are a couple lines that do have to be changed. I'll give you the entire 
one for the base API and then just give you the changes for the public:</p>
<h4><code>views/api/v1/docs/index.html.erb</code></h4>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token constant">Swagger</span> <span class="token constant">UI</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/css/typography.css'</span> media<span class="token operator">=</span><span class="token string">'screen'</span> rel<span class="token operator">=</span><span class="token string">'stylesheet'</span> type<span class="token operator">=</span><span class="token string">'text/css'</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/css/reset.css'</span> media<span class="token operator">=</span><span class="token string">'screen'</span> rel<span class="token operator">=</span><span class="token string">'stylesheet'</span> type<span class="token operator">=</span><span class="token string">'text/css'</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/css/screen.css'</span> media<span class="token operator">=</span><span class="token string">'screen'</span> rel<span class="token operator">=</span><span class="token string">'stylesheet'</span> type<span class="token operator">=</span><span class="token string">'text/css'</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/css/reset.css'</span> media<span class="token operator">=</span><span class="token string">'print'</span> rel<span class="token operator">=</span><span class="token string">'stylesheet'</span> type<span class="token operator">=</span><span class="token string">'text/css'</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/css/screen.css'</span> media<span class="token operator">=</span><span class="token string">'print'</span> rel<span class="token operator">=</span><span class="token string">'stylesheet'</span> type<span class="token operator">=</span><span class="token string">'text/css'</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"/swagger-ui/dist/lib/shred.bundle.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/lib/jquery-1.8.0.min.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/lib/jquery.slideto.min.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/lib/jquery.wiggle.min.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/lib/jquery.ba-bbq.min.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/lib/handlebars-2.0.0.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/lib/underscore-min.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/lib/backbone-min.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/lib/swagger-client.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/swagger-ui.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/lib/highlight.7.3.pack.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/lib/marked.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> enabling this will enable oauth2 implicit scope support <span class="token operator">--</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'/swagger-ui/dist/lib/swagger-oauth.js'</span> type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>
    <span class="token operator">/</span><span class="token operator">/</span>compatibility fix <span class="token keyword">until</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>swagger<span class="token operator">-</span>api<span class="token operator">/</span>swagger<span class="token operator">-</span>js<span class="token operator">/</span>pull<span class="token operator">/</span><span class="token number">278</span> can be merged
    window<span class="token punctuation">.</span>modelPropertyMacro <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> property<span class="token punctuation">.</span>defaultValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    $<span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      var url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/url=([^&amp;]+)/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">&amp;&amp;</span> url<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        url <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>url<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        url <span class="token operator">=</span> "<span class="token operator">&lt;</span><span class="token string">%= request.protocol + request.host_with_port %&gt;/docs/client/api-docs.json";
      }
      window.swaggerUi =</span> <span class="token keyword">new</span> <span class="token class-name">SwaggerUi</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token punctuation">:</span> url<span class="token punctuation">,</span>
        dom_id<span class="token punctuation">:</span> <span class="token string">"swagger-ui-container"</span><span class="token punctuation">,</span>
        supportedSubmitMethods<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token string">'put'</span><span class="token punctuation">,</span> <span class="token string">'delete'</span><span class="token punctuation">,</span> <span class="token string">'patch'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        onComplete<span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span>swaggerApi<span class="token punctuation">,</span> swaggerUi<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>typeof initOAuth <span class="token operator">==</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token operator">/</span><span class="token operator">*</span>
             <span class="token function">initOAuth</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
             clientId<span class="token punctuation">:</span> <span class="token string">"your-client-id"</span><span class="token punctuation">,</span>
             realm<span class="token punctuation">:</span> <span class="token string">"your-realms"</span><span class="token punctuation">,</span>
             appName<span class="token punctuation">:</span> <span class="token string">"your-app-name"</span>
             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token operator">*</span><span class="token operator">/</span>
          <span class="token punctuation">}</span>
          $<span class="token punctuation">(</span><span class="token string">'pre code'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">each</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hljs<span class="token punctuation">.</span><span class="token function">highlightBlock</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        onFailure<span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Unable to Load SwaggerUI"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        docExpansion<span class="token punctuation">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span>
        sorter <span class="token punctuation">:</span> <span class="token string">"alpha"</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      function <span class="token function">addApiKeyAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        var key <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token string">'#input_apiKey'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"key: "</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"added key "</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            window<span class="token punctuation">.</span>authorizations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"api_key"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ApiKeyAuthorization</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">,</span> <span class="token string">"Bearer "</span> <span class="token operator">+</span> key<span class="token punctuation">,</span> <span class="token string">"header"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token operator">/</span><span class="token operator">/</span> persist the api key to the session<span class="token punctuation">,</span> <span class="token keyword">for</span> testing convenience
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              type<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
              url<span class="token punctuation">:</span> "<span class="token operator">&lt;</span><span class="token string">%= public_api_v1_docs_persist_api_key_url %&gt;",
              beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name=</span><span class="token string">"csrf-token"</span><span class="token punctuation">]</span><span class="token string">').attr('</span>content'<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                swagger_api_key<span class="token punctuation">:</span> key
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              success<span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"persisted key to session"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      $<span class="token punctuation">(</span><span class="token string">'#input_apiKey'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">addApiKeyAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      window<span class="token punctuation">.</span>swaggerUi<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token string">%= csrf_meta_tags %&gt;
&lt;/head&gt;

&lt;body class=</span><span class="token string">"swagger-section"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">'header'</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"swagger-ui-wrap"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>a id<span class="token operator">=</span><span class="token string">"logo"</span> href<span class="token operator">=</span><span class="token string">"http://swagger.io"</span><span class="token operator">&gt;</span>swagger<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>form id<span class="token operator">=</span><span class="token string">'api_selector'</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">'input'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>input placeholder<span class="token operator">=</span><span class="token string">"http://example.com/api"</span> id<span class="token operator">=</span><span class="token string">"input_baseUrl"</span> name<span class="token operator">=</span><span class="token string">"baseUrl"</span> type<span class="token operator">=</span><span class="token string">"text"</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">'input'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>input placeholder<span class="token operator">=</span><span class="token string">"api_key"</span> id<span class="token operator">=</span><span class="token string">"input_apiKey"</span> name<span class="token operator">=</span><span class="token string">"apiKey"</span> type<span class="token operator">=</span><span class="token string">"text"</span> value<span class="token operator">=</span>"<span class="token operator">&lt;</span><span class="token string">%= session[:swagger_api_key] %&gt;"/&gt;&lt;/div&gt;
      &lt;div class=</span><span class="token string">'input'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a id<span class="token operator">=</span><span class="token string">"explore"</span> href<span class="token operator">=</span><span class="token string">"#"</span><span class="token operator">&gt;</span><span class="token constant">Explore</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"message-bar"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"swagger-ui-wrap"</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"swagger-ui-container"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"swagger-ui-wrap"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span></code></pre>
<h3><code>views/public_api/v1/docs/index.html.erb</code>:</h3>
<h4>Line 36 change to:</h4>
<pre class=" language-ruby"><code class=" language-ruby">        url <span class="token operator">=</span> <span class="token string">"&lt;%= request.protocol + request.host_with_port %&gt;/docs/client/api-docs.json"</span><span class="token punctuation">;</span></code></pre>
<h4>Line 73 change to:</h4>
<pre class=" language-ruby"><code class=" language-ruby">              url<span class="token punctuation">:</span> <span class="token string">"&lt;%= public_api_v1_docs_persist_api_key_url %&gt;"</span><span class="token punctuation">,</span></code></pre>
<h2>Conclusion</h2>
<p>Now you should be able to run <code>rake swagger:docs</code> and <code>rake swagger:public_api_docs</code>
 as separate tasks from the command line and generate two different sets
 of documentation based on their respective namespaces. These will be 
located at <code>/api/v1/docs</code> and <code>/public_api/v1/docs</code>. When running the new <code>rake swagger:public_api_docs</code> you'll get the following warnings:</p>
<pre class=" language-bash"><code class=" language-bash">/Users/ssmith/Sites/my-site/lib/tasks/swagger_compile_public_api_docs.rake:12: warning: already initialized constant Swagger::Docs::Config
/Users/ssmith/.rvm/gems/ruby-2.2.2/gems/swagger-docs-0.1.9/lib/swagger/docs/config.rb:3: warning: previous definition of Config was here
pub1.0: 1 proc / 55 skipped</code></pre>
<p>These are annoying but don't appear to cause any real problem. Once 
again, this is not a solution I love, but it got the job done. If I find
 out a different approach I'll report back.</p>
<p>Big props to <a href="https://github.com/faxanadu">Shea Hunter</a> for helping me get this figured out!</p>
</div>
                </div><!-- .body-inner -->
            </div><!-- site-bd -->
            <footer class="site-ft">
    <div class="footer-inner">
        <nav class="nav vr_half">
            <ul>
                <li>
                    <a href="https://github.com/voodooGQ" alt="GitHub" title="GitHub" class="icon icon-github"></a>
                </li>
                <li>
                    <a href="mailto:voodoogq@gmail.com" alt="E-mail Me" title="E-mail Me" class="icon icon-email"></a>
                </li>
            </ul>
        </nav>
        <span class="copyright">© 2017 - <a href="https://shaneallensmith.com/" target="_blank">Shane Smith</a>. All Rights Reserved.</span>
    </div>
</footer>
        </div><!-- .container-site -->
        <script type="text/javascript">
/* <![CDATA[ */
var cms_settings = {"ajaxUrl":"https:\/\/syntaxalert.com\/core\/wp-admin\/admin-ajax.php","themePath":"https:\/\/syntaxalert.com\/content\/themes\/oowp\/","themeVersion":"1.0"};
/* ]]> */
</script>
<script type="text/javascript" src="Multiple%20APIs%20documented%20by%20Swagger%20in%20Rails%20-%20Syntax%20Alert_files/app.js"></script>
<script type="text/javascript" src="Multiple%20APIs%20documented%20by%20Swagger%20in%20Rails%20-%20Syntax%20Alert_files/wp-embed.js"></script>
   

</body></html>